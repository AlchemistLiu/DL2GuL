# Q:å·ç§¯çš„è¾“å‡ºå½¢çŠ¶å–å†³äºŽè¾“å…¥å½¢çŠ¶å’Œå·ç§¯æ ¸çš„å½¢çŠ¶?
# A:å¡«å……ï¼ˆpaddingï¼‰å’Œ æ­¥å¹… (stride)éœ€è¦è¢«è€ƒè™‘
import torch 
from torch import nn


# è§‚å¯Ÿå¡«å……åŽè¾“å…¥å’Œè¾“å…¥ç»´åº¦çš„å˜æ¢ï¼Œçœç•¥å‰ä¸¤ä¸ªç»´åº¦å’Œæ‰¹é‡å¤§å°çš„é€šé“
# æœ¬è´¨æ˜¯ä¸€ä¸ªæ¯”è¾ƒå‡½æ•°
def comp_conv2d(conv2d, X):
    # æš‚æ—¶ä¸è€ƒè™‘é€šé“å’Œæ‰¹é‡ï¼Œæ•…ä¸º(1,1)
    X = X.reshape((1, 1) + X.shape)
    Y = conv2d(X)
    # çœç•¥å‰ä¸¤ä¸ªç»´åº¦ï¼Œåªæ¯”è¾ƒå·ç§¯åŽçš„å®½é«˜
    return Y.reshape(Y.shape[2:])

# ä¸€ä¸ªå·ç§¯å±‚
# ******************************************
# å·ç§¯æ ¸å¤§å°å°½é‡ç”¨å¥‡æ•°(æš‚æ—¶ä¸çŸ¥é“ä¸ºå•¥ï¼Œå…ˆç”¨ç€)
conv2d = nn.Conv2d(1, 1, kernel_size=3, padding=1)
# padding = 1å¹¶ä¸æ˜¯åªå¡«å……ä¸€è¡Œ/åˆ—-->â˜žæŒ‡æ¯è¾¹éƒ½å¡«å……äº†1è¡Œæˆ–1åˆ—ï¼Œå› æ­¤æ€»å…±æ·»åŠ äº†2è¡Œæˆ–2åˆ—
X = torch.rand(size=(8, 8))     # 8*8çš„è¾“å…¥
result = comp_conv2d(conv2d, X).shape
print(result)   # torch.Size([8, 8])
# (ð‘›â„Žâˆ’ð‘˜â„Ž+ð‘â„Ž+1)Ã—(ð‘›ð‘¤âˆ’ð‘˜ð‘¤+ð‘ð‘¤+1) --> (8-3+2+1)Ã—(8-3+2+1) -->8Ã—8

# å¡«å……ä¸åŒçš„é«˜åº¦å’Œå®½åº¦(2, 1)å’Œä¸åŒçš„å®½é«˜çš„å·ç§¯æ ¸(5, 3)
conv2d = nn.Conv2d(1, 1, kernel_size=(5, 3), padding=(2, 1))
result = comp_conv2d(conv2d, X).shape
print(result)    # torch.Size([8, 8])
# (8-5+4+1)Ã—(8-3+2+1) -->8Ã—8

# æ­¥å¹…stridå¯¹æ¯”
conv2d = nn.Conv2d(1, 1, kernel_size=3, padding=1, stride=2)
result = comp_conv2d(conv2d, X).shape
print(result)    # torch.Size([8, 8])
# âŒŠ(ð‘›â„Žâˆ’ð‘˜â„Ž+ð‘â„Ž+ð‘ â„Ž)/ð‘ â„ŽâŒ‹ Ã— âŒŠ(ð‘›ð‘¤âˆ’ð‘˜ð‘¤+ð‘ð‘¤+ð‘ ð‘¤)/ð‘ ð‘¤âŒ‹. --> (8-3+2+2)/2 Ã— (8-3+2+2)/2 --> 4Ã—4

# ä¸åŒçš„é«˜åº¦å’Œå®½åº¦ä¸Šçš„æ­¥å¹…(3, 4)å’Œä¸åŒçš„å®½é«˜çš„å·ç§¯æ ¸(3, 5)
conv2d = nn.Conv2d(1, 1, kernel_size=(3, 5), padding=(0, 1), stride=(3, 4))
result = comp_conv2d(conv2d, X).shape
print(result)    # torch.Size([2, 2])
# (8-3+0+3)/3Ã—(8-5+2+4)/4 -->2Ã—2